// DBConn.h: interface for the CDBConn class.
//
//////////////////////////////////////////////////////////////////////

#if !defined(AFX_DBCONN_H__6DF8B817_F3FB_11D1_8084_006097B38214__INCLUDED_)
#define AFX_DBCONN_H__6DF8B817_F3FB_11D1_8084_006097B38214__INCLUDED_

#if _MSC_VER >= 1000
#pragma once
#endif // _MSC_VER >= 1000

class CDBConn 
{
	////////////////////////////////////////////////////////////////
	//	
	//	A utility class for managing database connections.
	//  Connects to a database, returns the CDatabase object 
	//  when needed, and closes it when destroyed.
	//	
	////////////////////////////////////////////////////////////////


	////////////////////////////////////////////////////////////////
	//	
	//	Typedefs, enums, etc.
	//	
	////////////////////////////////////////////////////////////////


public:

	// constants identifying the four databases

	enum DBType { DB_DPA, DB_CSDA, DB_HM, DB_RULES };
	enum { NumDBTypes = DB_RULES+1 };



	////////////////////////////////////////////////////////////////
	//	
	//	Data
	//	
	////////////////////////////////////////////////////////////////

private:

	DBType m_which;
		// which database to connect to.
		// set when constructed.
		// used when the database is begin connected to.

	CDatabase m_db;
		// the database object holding the connection.

	static CString DSNs[NumDBTypes];
		// holds the DSN string for each of the databases

	static bool DSNsInitialized;
		// flag to ensure once-only initialization



	////////////////////////////////////////////////////////////////
	//	
	//	Accessors
	//	
	////////////////////////////////////////////////////////////////

public:

	CDatabase* GetDB();


	////////////////////////////////////////////////////////////////
	//	
	//	C-tors, d-tor
	//	
	////////////////////////////////////////////////////////////////

public:
	CDBConn(DBType which);
	virtual ~CDBConn();


	////////////////////////////////////////////////////////////////
	//	
	//	Operations
	//	
	////////////////////////////////////////////////////////////////

public:

	bool Connect();
		// open the database connection.

	bool IsOpen();
		// test whether connection is open


	////////////////////////////////////////////////////////////////
	//	
	//	Implementation
	//	
	////////////////////////////////////////////////////////////////

	static void InitializeDSNs();


};

#endif // !defined(AFX_DBCONN_H__6DF8B817_F3FB_11D1_8084_006097B38214__INCLUDED_)
